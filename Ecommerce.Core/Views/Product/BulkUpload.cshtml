@using static Ecommerce.Repository.Helpers.Enums


@{
    Layout = "~/Views/Shared/_dashboardSeller.cshtml";
}

<div class="d-flex justify-content-between w-100 p-3 container">
    <h3 class="text-color">
        Add Products In Bulk
    </h3>

    <div>
        <a class="btn btn-primary" id="AddProduct-btn" asp-action="AddProduct" asp-controller="Product">
            <i class="bi bi-chevron-left"></i> Back to add products
        </a>
    </div>
</div>
<div class="container d-flex gap-3">
    <div class="MyOrder p-3 mb-4 w-50">
        <div class="d-flex justify-content-start align-items-center gap-2">
            <h4 class="font-monospace text-secondary">For Bulk Upload</h4>
            <img src="~/images/airplane_10521415.png" alt="" height="20px" width="20px">
        </div>
        <hr />
        <ul class="ps-3">
            <li>Inorder to add multiple product in single go,
                first download the <strong>.xlxs</strong> file which is here,
                which will guide you to insert details into excel sheet,
                which you need to attach to input, only <strong>.xlxs</strong> is valid!
            </li>
        </ul>
    </div>
    <div class="d-flex flex-column gap-3 w-50">
        <a class="btn btn-primary DownloadSampleTamplate" asp-action="DownloadTemplate" asp-controller="Product">
            Download Template
        </a>
        <form method="post" id="uploadForm" enctype="multipart/form-data" class="d-flex flex-column gap-3">
            <div class="form-group">
                <label class="text-color" for="file">Select Excel File (.xlsx)</label>
                <input type="file" id="file" name="file" accept=".xlsx" class="form-control" />
            </div>
            <button type="submit" class="btn  btn-success mb-3">Upload</button>
        </form>
    </div>
</div>
<div id="message"></div>

@section scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        window.successMessage = '@TempData["SuccessMessage"]';
        window.errorMessage = '@TempData["ErrorMessage"]';
        $(document).ready(function () {
            $(document).on('submit', '#uploadForm', function (e) {
                e.preventDefault();
                var formData = new FormData(this);
                $.ajax({
                    url: '/Product/UploadProducts',
                    method: 'POST',
                    processData: false,
                    contentType: false,
                    data: formData,
                    success: function (response) {
                        if(response.success)
                        {
                            toastr.success(response.message,"Success",{timeOut:5000});
                        }
                        else
                        {
                            toastr.error(response.message,"Error",{timeOut:5000})
                        }
                        $('#message').html('<div class="alert alert-' + (response.success ? 'success' : 'danger') + '">' + response.message + '</div>');
                    },
                    error: function (xhr) {
                        $('#message').html('<div class="alert alert-danger">Error: ' + (xhr.status === 401 ? 'Unauthorized access.' : 'An error occurred while uploading the file.') + '</div>');
                    }
                });
            });
        });
    </script>
    <script src="~/js/toastr_script.js"></script>
}
